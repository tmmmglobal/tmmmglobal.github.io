{"version":3,"sources":["webpack:///./src/views/views/setting/supernode.vue?c888","webpack:///./src/views/views/setting/supernode.vue?bcaf","webpack:///src/views/views/setting/supernode.vue","webpack:///./src/views/views/setting/supernode.vue?b08d","webpack:///./src/views/views/setting/supernode.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","$t","origin","supernode","staticClass","_v","_s","bought","nodeToken","on","buyNode","nodePrice","authorizedAccess","authorizedAccessFun","authorizationEnds","end","staticRenderFns","component"],"mappings":"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","file":"js/chunk-76983da6.23ae5dfc.js","sourcesContent":["import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=style&index=0&id=26364e20&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=style&index=0&id=26364e20&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('grade-box',{attrs:{\"title\":_vm.$t('supernode'),\"origin\":_vm.origin,\"supernode\":_vm.supernode}},[_c('div',{staticClass:\"supernode\"},[_c('div',{staticClass:\"title\"},[_c('span',[_vm._v(_vm._s(_vm.$t('supernode')))]),_c('p',[_vm._v(_vm._s(_vm.bought)),_c('span',[_vm._v(\"/33\")])])]),_c('div',{staticClass:\"text\"},[_c('p',[_vm._v(_vm._s(_vm.$t('zunxiang'))+\" \"),_c('span',[_vm._v(\"M3\"+_vm._s(_vm.$t('level')))])]),_c('p',[_vm._v(_vm._s(_vm.$t('peisong'))+\" \"),_c('span',[_vm._v(_vm._s(_vm.nodeToken)+\" MPC\")])]),_c('p',[_vm._v(_vm._s(_vm.$t('zhengsong'))+\" \"),_c('span',[_vm._v(\"5个M1+2个M2\")])]),_c('p',[_vm._v(_vm._s(_vm.$t('fenhong'))+\" \"),_c('span',[_vm._v(\"1个\")])])]),_c('Button',{attrs:{\"disabled\":_vm.supernode >= 6,\"color\":\"linear-gradient(41deg, #F5D755, #FFA271)\"},on:{\"click\":_vm.buyNode}},[_vm._v(_vm._s(_vm.$t('liji'))+_vm._s(_vm.nodePrice)+\" USDT\")])],1),_c('authorization',{attrs:{\"tokenType\":\"USDT\",\"show\":_vm.authorizedAccess,\"click\":_vm.authorizedAccessFun,\"needAuthorization\":_vm.nodePrice,\"authorizationEnds\":_vm.authorizationEnds},on:{\"authorizationEnds\":_vm.end}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <grade-box :title=\"$t('supernode')\" :origin=\"origin\" :supernode=\"supernode\">\r\n        <div class=\"supernode\">\r\n            <div class=\"title\">\r\n                <span>{{ $t('supernode') }}</span>\r\n                <p>{{ bought }}<span>/33</span></p>\r\n            </div>\r\n            <div class=\"text\">\r\n                <p>{{ $t('zunxiang') }} <span>M3{{ $t('level') }}</span></p>\r\n                <p>{{ $t('peisong') }} <span>{{ nodeToken }} MPC</span></p>\r\n                <p>{{ $t('zhengsong') }} <span>5个M1+2个M2</span></p>\r\n                <p>{{ $t('fenhong') }} <span>1个</span></p>\r\n            </div>\r\n            <Button :disabled=\"supernode >= 6\" @click=\"buyNode\" color=\"linear-gradient(41deg, #F5D755, #FFA271)\">{{ $t('liji') }}{{ nodePrice }} USDT</Button>\r\n        </div>\r\n        <authorization\r\n\t\t  tokenType=\"USDT\"\r\n\t\t  :show=\"authorizedAccess\" \r\n\t\t  :click=\"authorizedAccessFun\"\r\n\t\t  :needAuthorization='nodePrice'\r\n\t\t  :authorizationEnds=\"authorizationEnds\"\r\n\t\t  @authorizationEnds=\"end\"\r\n\t\t></authorization>\r\n    </grade-box>\r\n</template>\r\n\r\n<script>\r\n    import { Button, Toast } from 'vant';\r\n\r\n    export default {\r\n        name: 'supernode',\r\n        components: {\r\n            Button,\r\n            'grade-box': () => import(/* WebpackChunkName: 'supernode' */ '@/components/grade-box'),\r\n            'authorization': () => import(/* WebpackChunkName: 'supernode' */ '@/components/Authorization.vue')\r\n        },\r\n        data() {\r\n            return {\r\n                origin: 0,\r\n                nodePrice: 0,\r\n                nodeToken: 0,\r\n                usdt: '0',\r\n                authorizedAccess: false,\r\n                authorizationEnds: false,\r\n                USDTAuthorizedAccess: '',\r\n                supernode: 0,\r\n                bought: 0\r\n            }\r\n        },\r\n        methods: {\r\n            buyNode() {\r\n                if(Number(this.usdt) < Number(this.nodePrice)){\r\n\t\t\t\t\treturn Toast.fail(this.$t('InsufficientBalance'));\r\n\t\t\t\t}else if(Number(this.USDTAuthorizedAccess) < Number(this.nodePrice)){\r\n\t\t\t\t\treturn this.authorizedAccess = true;\r\n                }\r\n                Toast.loading({\r\n\t\t\t\t\tmessage: '正在交易中...',\r\n\t\t\t\t\tforbidClick: true,\r\n\t\t\t\t\tduration: 0\r\n\t\t\t\t});\r\n\r\n                this.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\r\n\t\t\t\t\tmethod: 'paymentSuperNode()'\r\n\t\t\t\t}).then(async result => {\r\n\r\n                    this.$contracts.Manager.paymentSuperNode()\r\n                    .send({ feeLimit: '50'.toSun() }).then(hex => {\r\n                        sessionStorage.setItem('transactionHex', hex);\r\n\r\n                        const interval = setInterval(() => {\r\n                            window.tronWeb.trx.getTransaction(hex).then(transaction => {\r\n                                if (transaction.ret && transaction.ret[0].contractRet === 'SUCCESS') {\r\n                                    sessionStorage.removeItem('transactionHex');\r\n                                    clearInterval(interval);\r\n\r\n                                    Toast.clear();\r\n                                    this.App_Push('/setting');\r\n                                }\r\n                            })\r\n                        }, 2000);\r\n                    })\r\n\r\n                }).catch(err => {\r\n\t\t\t\t\tToast.clear();\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t});\r\n            },\r\n            authorizedAccessFun() {\r\n                Toast.loading({\r\n\t\t\t\t\tmessage: '正在交易中...',\r\n\t\t\t\t\tforbidClick: true,\r\n\t\t\t\t\tduration: 0\r\n\t\t\t\t});\r\n                \r\n\t\t\t\tthis.$contracts.ERC20Token.approve(\r\n\t\t\t\t\tthis.$contracts.Manager.address,\r\n\t\t\t\t\tthis.nodePrice.toSun()\r\n\t\t\t\t).send({ feeLimit: '50'.toSun() }).then(hex => {\r\n                    sessionStorage.setItem('transactionHex', hex);\r\n\r\n                    const interval = setInterval(() => {\r\n                        window.tronWeb.trx.getTransaction(hex).then(transaction => {\r\n                            if (transaction.ret && transaction.ret[0].contractRet === 'SUCCESS') {\r\n                                sessionStorage.removeItem('transactionHex');\r\n                                clearInterval(interval);\r\n\r\n                                this.$tronWeb.call({\r\n                                    contractAddress: this.$contracts.ERC20Token.address,\r\n                                    method: 'allowance(address,address)',\r\n                                    parameter: [\r\n                                        { type: 'address', value: this.$address },\r\n                                        { type: 'address', value: this.$contracts.Manager.address }\r\n                                    ]\r\n                                }).then(res => {\r\n                                    Toast.clear();\r\n                                    this.authorizedAccess = false;\r\n                                    this.authorizationEnds = true;\r\n                                    this.USDTAuthorizedAccess = res.constant_result[0].decode(['uint256']).toString().fromSun();\r\n\r\n                                    this.buyNode();\r\n                                });\r\n                            }\r\n                        })\r\n                    }, 2000);\r\n\r\n\t\t\t\t}).catch(err => {\r\n                    Toast.clear();\r\n                    console.log(err);\r\n                });\r\n            },\r\n            end(){\r\n\t\t\t\tthis.authorizedAccess = false;\r\n\t\t\t},\r\n            init() {\r\n                //是否购买了超级节点\r\n                this.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\r\n                    method: 'purchasedMapping(address)',\r\n                    parameter: [{ type: 'address', value: this.$address }]\r\n\t\t\t\t}).then(result => {\r\n\t\t\t\t\tconst { levelNum } = result.constant_result[0].decode(['uint256','uint256','uint256'], ['levelNum','price','sentToken']);\r\n                    \r\n                    this.supernode = levelNum.toNumber();\r\n                })\r\n\r\n                //查询等级\r\n\t\t\t\tthis.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.Relations.address,\r\n                    method: 'levelOf(address)',\r\n                    parameter: [{ type: \"address\", value: this.$address }]\r\n\t\t\t\t}).then(result => {\r\n\t\t\t\t\tconst origin = result.constant_result[0].decode(['uint256']);\r\n\t\t\t\t\t// 原等级\r\n                    this.origin = origin.toNumber();\r\n                })\r\n\r\n                //购买超级节点需要的USDT\r\n                this.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\r\n                    method: 'goodsMapping(uint256)',\r\n                    parameter: [{ type: 'uint256', value: 6 }]\r\n\t\t\t\t}).then(result => {\r\n                    const { price, sentToken } = result.constant_result[0].decode(['uint256', 'uint256', 'uint256'], ['levelNum', 'price', 'sentToken']);\r\n\r\n                    this.nodePrice = price.toString().fromSun();\r\n                    this.nodeToken = sentToken.toString().fromSun();\r\n                })\r\n\r\n                // usdt的额度\r\n\t\t\t\tthis.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.ERC20Token.address,\r\n\t\t\t\t\tmethod: 'balanceOf(address)',\r\n\t\t\t\t\tparameter: [{ type: \"address\", value: this.$address }]\r\n\t\t\t\t}).then(result => {\r\n\t\t\t\t\tconst res = result.constant_result[0].decode(['uint256']);\r\n\t\t\t\t\tthis.usdt = res.toString().fromSun();\r\n                })\r\n                \r\n                // 授权额度\r\n\t\t\t\tthis.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.ERC20Token.address,\r\n\t\t\t\t\tmethod: 'allowance(address,address)',\r\n\t\t\t\t\tparameter: [\r\n\t\t\t\t\t\t{ type: \"address\", value: this.$address },\r\n\t\t\t\t\t\t{ type: \"address\", value: this.$contracts.Manager.address }\r\n\t\t\t\t\t]\r\n\t\t\t\t}).then(result => {\r\n\t\t\t\t\tconst res = result.constant_result[0].decode(['uint256']);\r\n\t\t\t\t\tthis.USDTAuthorizedAccess = res.toString().fromSun();\r\n                })\r\n                \r\n                // 已购买数量\r\n                this.$tronWeb.call({\r\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\r\n\t\t\t\t\tmethod: 'stockInfoList()'\r\n\t\t\t\t}).then(res => {\r\n                    const [, , , V4] = res.constant_result[0].decode(['uint256[]']);\r\n                    this.bought = V4.toString();\r\n                })\r\n            }\r\n        },\r\n        created() {\r\n            this.$tronWeb && this.init();\r\n        }\r\n    }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .supernode {\r\n        padding: 22px 40px 42px;\r\n        border: 2px solid #FFB600;\r\n        background-color: #fff;\r\n        margin: 44px 0 62px;\r\n        border-radius: 20px;\r\n        &>button {\r\n            width: 100%;\r\n            height: 90px;\r\n            color: #B56900 !important;\r\n            font-size: 44px;\r\n            border-radius: 8px;\r\n            box-shadow: 0 6px 12px rgba(#000, .16);\r\n            margin-top: 36px;\r\n        }\r\n        &>.text {\r\n            color: #656363;\r\n            font-size: 32px;\r\n            text-align: left;\r\n            margin-top: 24px;\r\n            &>p {\r\n                margin-bottom: 14px;\r\n                &:first-child>span {\r\n                    color: #F9C061;\r\n                }\r\n                &:nth-child(2)>span {\r\n                    color: #21C17A;\r\n                }\r\n                &:last-child>span {\r\n                    color: #FF1F79;\r\n                }\r\n            }\r\n        }\r\n        &>.title {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            color: #FF1F79;\r\n            &>p {\r\n                font-size: 40px;\r\n                &>span {\r\n                    color: #656363;\r\n                }\r\n            }\r\n            &>span {\r\n                width: 355px;\r\n                color: #fff;\r\n                font-size: 44px;\r\n                padding: 10px 0;\r\n                border: 2px solid #FF1F79;\r\n                border-radius: 8px;\r\n                background-color: #F99CF6;\r\n            }\r\n        }\r\n    }\r\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./supernode.vue?vue&type=template&id=26364e20&scoped=true&\"\nimport script from \"./supernode.vue?vue&type=script&lang=js&\"\nexport * from \"./supernode.vue?vue&type=script&lang=js&\"\nimport style0 from \"./supernode.vue?vue&type=style&index=0&id=26364e20&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"26364e20\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}