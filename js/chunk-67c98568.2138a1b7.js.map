{"version":3,"sources":["webpack:///./src/views/views/setting/supernode.vue?4c34","webpack:///src/views/views/setting/supernode.vue","webpack:///./src/views/views/setting/supernode.vue?b08d","webpack:///./src/views/views/setting/supernode.vue","webpack:///./src/views/views/setting/supernode.vue?3f9a"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","$t","origin","supernode","staticClass","_v","_s","bought","nodeToken","on","buyNode","nodePrice","authorizedAccess","authorizedAccessFun","authorizationEnds","end","staticRenderFns","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,YAAY,CAACE,MAAM,CAAC,MAAQN,EAAIO,GAAG,aAAa,OAASP,EAAIQ,OAAO,UAAYR,EAAIS,YAAY,CAACL,EAAG,MAAM,CAACM,YAAY,aAAa,CAACN,EAAG,MAAM,CAACM,YAAY,SAAS,CAACN,EAAG,OAAO,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,iBAAiBH,EAAG,IAAI,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIa,SAAST,EAAG,OAAO,CAACJ,EAAIW,GAAG,aAAaP,EAAG,MAAM,CAACM,YAAY,QAAQ,CAACN,EAAG,IAAI,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,aAAa,KAAKH,EAAG,OAAO,CAACJ,EAAIW,GAAG,KAAKX,EAAIY,GAAGZ,EAAIO,GAAG,eAAeH,EAAG,IAAI,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,YAAY,KAAKH,EAAG,OAAO,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIc,WAAW,YAAYV,EAAG,IAAI,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,cAAc,KAAKH,EAAG,OAAO,CAACJ,EAAIW,GAAG,iBAAiBP,EAAG,IAAI,CAACJ,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,YAAY,KAAKH,EAAG,OAAO,CAACJ,EAAIW,GAAG,YAAYP,EAAG,SAAS,CAACE,MAAM,CAAC,SAAWN,EAAIS,WAAa,EAAE,MAAQ,4CAA4CM,GAAG,CAAC,MAAQf,EAAIgB,UAAU,CAAChB,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIO,GAAG,SAASP,EAAIY,GAAGZ,EAAIiB,WAAW,YAAY,GAAGb,EAAG,gBAAgB,CAACE,MAAM,CAAC,UAAY,OAAO,KAAON,EAAIkB,iBAAiB,MAAQlB,EAAImB,oBAAoB,kBAAoBnB,EAAIiB,UAAU,kBAAoBjB,EAAIoB,mBAAmBL,GAAG,CAAC,kBAAoBf,EAAIqB,QAAQ,IACzpCC,EAAkB,G,oHC4BtB,GACE,KAAF,YACE,WAAF,CACI,OAAJ,OACI,YAAJ,WAAM,OAAN,iDACI,cAAJ,WAAM,OAAN,8CAEE,KAPF,WAQI,MAAJ,CACM,OAAN,EACM,UAAN,EACM,UAAN,EACM,KAAN,IACM,kBAAN,EACM,mBAAN,EACM,qBAAN,GACM,UAAN,EACM,OAAN,IAGE,QAAF,CACI,QADJ,WACM,IAAN,OACM,OAAN,yCACA,4CACA,yDACA,0BAEM,OAAN,SACA,mBACA,eACA,kBAGM,KAAN,eACA,gDACA,8BACA,KAHM,WAAE,IAAR,iBAAQ,mBAAR,MAGA,+FAEkB,EAAlB,sCACA,MAAoB,SAApB,kCACoB,eAApB,4BAEA,8BACA,uDACA,0CACA,4CACA,iBAE0B,OAA1B,QAC0B,EAA1B,2BAGA,QAhBA,2CAHQ,OAAR,YAAU,OAAV,yBAAM,IAsBN,mBACA,eACA,oBAGI,oBAxCJ,WAwCM,IAAN,OACM,OAAN,SACA,mBACA,eACA,aAGA,mCACA,gCACA,wBACA,iDACQ,eAAR,4BAEA,8BACA,uDACA,0CACA,4CACA,iBAEc,EAAd,eACgB,gBAAhB,gCACgB,OAAhB,6BACgB,UAAhB,CACA,CAAkB,KAAlB,UAAkB,MAAlB,YACA,CAAkB,KAAlB,UAAkB,MAAlB,iCAEA,kBACgB,OAAhB,QACgB,EAAhB,oBACgB,EAAhB,qBACgB,EAAhB,mFAEgB,EAAhB,mBAIA,QAEA,mBACQ,OAAR,QACQ,QAAR,WAGI,IAnFJ,WAoFA,0BAEI,KAtFJ,WAsFM,IAAN,OAEM,KAAN,eACA,gDACQ,OAAR,4BACQ,UAAR,EAAU,KAAV,UAAU,MAAV,kBACA,wBACA,gGADA,EACA,SAEQ,EAAR,0BAIA,oBACA,kDACQ,OAAR,mBACQ,UAAR,EAAU,KAAV,UAAU,MAAV,kBACA,kBACA,+CAEQ,EAAR,uBAIM,KAAN,eACA,gDACQ,OAAR,wBACQ,UAAR,EAAU,KAAV,UAAU,MAAV,MACA,wBACA,gGADA,EACA,QADA,EACA,UAEQ,EAAR,iCACQ,EAAR,oCAIA,oBACA,mDACA,4BACA,mDACA,kBACA,+CACA,iCAIA,oBACA,mDACA,oCACA,WACA,qCACA,0DAEA,kBACA,+CACA,iDAIM,KAAN,eACA,gDACA,2BACA,wBACA,2CADA,sBACA,EADA,KAEQ,EAAR,yBAIE,QA9KF,WA+KI,KAAJ,wBC5MiX,I,wBCQ7WC,EAAY,eACd,EACAxB,EACAuB,GACA,EACA,KACA,WACA,MAIa,aAAAC,E,oECnBf,yBAAglB,EAAG","file":"js/chunk-67c98568.2138a1b7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('grade-box',{attrs:{\"title\":_vm.$t('supernode'),\"origin\":_vm.origin,\"supernode\":_vm.supernode}},[_c('div',{staticClass:\"supernode\"},[_c('div',{staticClass:\"title\"},[_c('span',[_vm._v(_vm._s(_vm.$t('supernode')))]),_c('p',[_vm._v(_vm._s(_vm.bought)),_c('span',[_vm._v(\"/33\")])])]),_c('div',{staticClass:\"text\"},[_c('p',[_vm._v(_vm._s(_vm.$t('zunxiang'))+\" \"),_c('span',[_vm._v(\"M3\"+_vm._s(_vm.$t('level')))])]),_c('p',[_vm._v(_vm._s(_vm.$t('peisong'))+\" \"),_c('span',[_vm._v(_vm._s(_vm.nodeToken)+\" MPC\")])]),_c('p',[_vm._v(_vm._s(_vm.$t('zhengsong'))+\" \"),_c('span',[_vm._v(\"5个M1+2个M2\")])]),_c('p',[_vm._v(_vm._s(_vm.$t('fenhong'))+\" \"),_c('span',[_vm._v(\"1个\")])])]),_c('Button',{attrs:{\"disabled\":_vm.supernode >= 6,\"color\":\"linear-gradient(41deg, #F5D755, #FFA271)\"},on:{\"click\":_vm.buyNode}},[_vm._v(_vm._s(_vm.$t('liji'))+_vm._s(_vm.nodePrice)+\" USDT\")])],1),_c('authorization',{attrs:{\"tokenType\":\"USDT\",\"show\":_vm.authorizedAccess,\"click\":_vm.authorizedAccessFun,\"needAuthorization\":_vm.nodePrice,\"authorizationEnds\":_vm.authorizationEnds},on:{\"authorizationEnds\":_vm.end}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <grade-box :title=\"$t('supernode')\" :origin=\"origin\" :supernode=\"supernode\">\n        <div class=\"supernode\">\n            <div class=\"title\">\n                <span>{{ $t('supernode') }}</span>\n                <p>{{ bought }}<span>/33</span></p>\n            </div>\n            <div class=\"text\">\n                <p>{{ $t('zunxiang') }} <span>M3{{ $t('level') }}</span></p>\n                <p>{{ $t('peisong') }} <span>{{ nodeToken }} MPC</span></p>\n                <p>{{ $t('zhengsong') }} <span>5个M1+2个M2</span></p>\n                <p>{{ $t('fenhong') }} <span>1个</span></p>\n            </div>\n            <Button :disabled=\"supernode >= 6\" @click=\"buyNode\" color=\"linear-gradient(41deg, #F5D755, #FFA271)\">{{ $t('liji') }}{{ nodePrice }} USDT</Button>\n        </div>\n        <authorization\n\t\t  tokenType=\"USDT\"\n\t\t  :show=\"authorizedAccess\" \n\t\t  :click=\"authorizedAccessFun\"\n\t\t  :needAuthorization='nodePrice'\n\t\t  :authorizationEnds=\"authorizationEnds\"\n\t\t  @authorizationEnds=\"end\"\n\t\t></authorization>\n    </grade-box>\n</template>\n\n<script>\n    import { Button, Toast } from 'vant';\n\n    export default {\n        name: 'supernode',\n        components: {\n            Button,\n            'grade-box': () => import(/* WebpackChunkName: 'supernode' */ '@/components/grade-box'),\n            'authorization': () => import(/* WebpackChunkName: 'supernode' */ '@/components/Authorization.vue')\n        },\n        data() {\n            return {\n                origin: 0,\n                nodePrice: 0,\n                nodeToken: 0,\n                usdt: '0',\n                authorizedAccess: false,\n                authorizationEnds: false,\n                USDTAuthorizedAccess: '',\n                supernode: 0,\n                bought: 0\n            }\n        },\n        methods: {\n            buyNode() {\n                if(Number(this.usdt) < Number(this.nodePrice)){\n\t\t\t\t\treturn Toast.fail(this.$t('InsufficientBalance'));\n\t\t\t\t}else if(Number(this.USDTAuthorizedAccess) < Number(this.nodePrice)){\n\t\t\t\t\treturn this.authorizedAccess = true;\n                }\n                Toast.loading({\n\t\t\t\t\tmessage: '正在交易中...',\n\t\t\t\t\tforbidClick: true,\n\t\t\t\t\tduration: 0\n\t\t\t\t});\n\n                this.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\n\t\t\t\t\tmethod: 'paymentSuperNode()'\n\t\t\t\t}).then(async result => {\n\n                    this.$contracts.Manager.paymentSuperNode()\n                    .send({ feeLimit: '150'.toSun() }).then(hex => {\n                        sessionStorage.setItem('transactionHex', hex);\n\n                        const interval = setInterval(() => {\n                            window.tronWeb.trx.getTransaction(hex).then(transaction => {\n                                if (transaction.ret && transaction.ret[0].contractRet === 'SUCCESS') {\n                                    sessionStorage.removeItem('transactionHex');\n                                    clearInterval(interval);\n\n                                    Toast.clear();\n                                    this.App_Push('/setting');\n                                }\n                            })\n                        }, 2000);\n                    })\n\n                }).catch(err => {\n\t\t\t\t\tToast.clear();\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t});\n            },\n            authorizedAccessFun() {\n                Toast.loading({\n\t\t\t\t\tmessage: '正在交易中...',\n\t\t\t\t\tforbidClick: true,\n\t\t\t\t\tduration: 0\n\t\t\t\t});\n                \n\t\t\t\tthis.$contracts.ERC20Token.approve(\n\t\t\t\t\tthis.$contracts.Manager.address,\n\t\t\t\t\tthis.nodePrice.toSun()\n\t\t\t\t).send({ feeLimit: '150'.toSun() }).then(hex => {\n                    sessionStorage.setItem('transactionHex', hex);\n\n                    const interval = setInterval(() => {\n                        window.tronWeb.trx.getTransaction(hex).then(transaction => {\n                            if (transaction.ret && transaction.ret[0].contractRet === 'SUCCESS') {\n                                sessionStorage.removeItem('transactionHex');\n                                clearInterval(interval);\n\n                                this.$tronWeb.call({\n                                    contractAddress: this.$contracts.ERC20Token.address,\n                                    method: 'allowance(address,address)',\n                                    parameter: [\n                                        { type: 'address', value: this.$address },\n                                        { type: 'address', value: this.$contracts.Manager.address }\n                                    ]\n                                }).then(res => {\n                                    Toast.clear();\n                                    this.authorizedAccess = false;\n                                    this.authorizationEnds = true;\n                                    this.USDTAuthorizedAccess = res.constant_result[0].decode(['uint256']).toString().fromSun();\n\n                                    this.buyNode();\n                                });\n                            }\n                        })\n                    }, 2000);\n\n\t\t\t\t}).catch(err => {\n                    Toast.clear();\n                    console.log(err);\n                });\n            },\n            end(){\n\t\t\t\tthis.authorizedAccess = false;\n\t\t\t},\n            init() {\n                //是否购买了超级节点\n                this.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\n                    method: 'purchasedMapping(address)',\n                    parameter: [{ type: 'address', value: this.$address }]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tconst { levelNum } = result.constant_result[0].decode(['uint256','uint256','uint256'], ['levelNum','price','sentToken']);\n                    \n                    this.supernode = levelNum.toNumber();\n                })\n\n                //查询等级\n\t\t\t\tthis.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.Relations.address,\n                    method: 'levelOf(address)',\n                    parameter: [{ type: \"address\", value: this.$address }]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tconst origin = result.constant_result[0].decode(['uint256']);\n\t\t\t\t\t// 原等级\n                    this.origin = origin.toNumber();\n                })\n\n                //购买超级节点需要的USDT\n                this.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\n                    method: 'goodsMapping(uint256)',\n                    parameter: [{ type: 'uint256', value: 6 }]\n\t\t\t\t}).then(result => {\n                    const { price, sentToken } = result.constant_result[0].decode(['uint256', 'uint256', 'uint256'], ['levelNum', 'price', 'sentToken']);\n\n                    this.nodePrice = price.toString().fromSun();\n                    this.nodeToken = sentToken.toString().fromSun();\n                })\n\n                // usdt的额度\n\t\t\t\tthis.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.ERC20Token.address,\n\t\t\t\t\tmethod: 'balanceOf(address)',\n\t\t\t\t\tparameter: [{ type: \"address\", value: this.$address }]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tconst res = result.constant_result[0].decode(['uint256']);\n\t\t\t\t\tthis.usdt = res.toString().fromSun();\n                })\n                \n                // 授权额度\n\t\t\t\tthis.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.ERC20Token.address,\n\t\t\t\t\tmethod: 'allowance(address,address)',\n\t\t\t\t\tparameter: [\n\t\t\t\t\t\t{ type: \"address\", value: this.$address },\n\t\t\t\t\t\t{ type: \"address\", value: this.$contracts.Manager.address }\n\t\t\t\t\t]\n\t\t\t\t}).then(result => {\n\t\t\t\t\tconst res = result.constant_result[0].decode(['uint256']);\n\t\t\t\t\tthis.USDTAuthorizedAccess = res.toString().fromSun();\n                })\n                \n                // 已购买数量\n                this.$tronWeb.call({\n\t\t\t\t\tcontractAddress: this.$contracts.Manager.address,\n\t\t\t\t\tmethod: 'stockInfoList()'\n\t\t\t\t}).then(res => {\n                    const [, , , V4] = res.constant_result[0].decode(['uint256[]']);\n                    this.bought = V4.toString();\n                })\n            }\n        },\n        created() {\n            this.$tronWeb && this.init();\n        }\n    }\n</script>\n\n<style lang=\"scss\" scoped>\n    .supernode {\n        padding: 22px 40px 42px;\n        border: 2px solid #FFB600;\n        background-color: #fff;\n        margin: 44px 0 62px;\n        border-radius: 20px;\n        &>button {\n            width: 100%;\n            height: 90px;\n            color: #B56900 !important;\n            font-size: 44px;\n            border-radius: 8px;\n            box-shadow: 0 6px 12px rgba(#000, .16);\n            margin-top: 36px;\n        }\n        &>.text {\n            color: #656363;\n            font-size: 32px;\n            text-align: left;\n            margin-top: 24px;\n            &>p {\n                margin-bottom: 14px;\n                &:first-child>span {\n                    color: #F9C061;\n                }\n                &:nth-child(2)>span {\n                    color: #21C17A;\n                }\n                &:last-child>span {\n                    color: #FF1F79;\n                }\n            }\n        }\n        &>.title {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            color: #FF1F79;\n            &>p {\n                font-size: 40px;\n                &>span {\n                    color: #656363;\n                }\n            }\n            &>span {\n                width: 355px;\n                color: #fff;\n                font-size: 44px;\n                padding: 10px 0;\n                border: 2px solid #FF1F79;\n                border-radius: 8px;\n                background-color: #F99CF6;\n            }\n        }\n    }\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./supernode.vue?vue&type=template&id=c211c85a&scoped=true&\"\nimport script from \"./supernode.vue?vue&type=script&lang=js&\"\nexport * from \"./supernode.vue?vue&type=script&lang=js&\"\nimport style0 from \"./supernode.vue?vue&type=style&index=0&id=c211c85a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"c211c85a\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=style&index=0&id=c211c85a&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./supernode.vue?vue&type=style&index=0&id=c211c85a&lang=scss&scoped=true&\""],"sourceRoot":""}